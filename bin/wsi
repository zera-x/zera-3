#!/usr/bin/env node --harmony
//require("repl").start({useGlobal:true});

var readline = require('readline')
  , ws = require('../dist/wonderscript.js')
  , wonderscript = ws;

var rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
  terminal: true
});

rl.setPrompt(ws.str(ws.ns(), "> "));
rl.prompt();

var env = [];

rl.on('line', function(code) {
  //try {
    env.push(ws.read(code.trim()));
    var code = ws.map(function(expr){ return ws.emit(expr) }, env).join(';');
    var res = eval(code);
    console.log(ws.pprint(res));
    rl.setPrompt(ws.str(ws.ns(), "> "));
  /*}
  catch (e) {
    console.error(e);
  }*/
  rl.prompt();
});

//rl.close();
